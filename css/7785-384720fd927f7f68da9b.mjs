(window.webpackChunkepibase=window.webpackChunkepibase||[]).push([[7785,3722],{3018:function(e,t,a){"use strict";a.d(t,{iF:function(){return i},OP:function(){return s},C_:function(){return r},er:function(){return o},Jb:function(){return l},cn:function(){return c},Fi:function(){return d}});class n{constructor(e,t){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;this.watermarkFormId=a,this.skipAuthentication=e,this.skipWatermarking=t,this.watermarkFormSubmissionId=n}}class i extends n{constructor(e,t,a){super(t,a,arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,arguments.length>4&&void 0!==arguments[4]?arguments[4]:null),this.packageId=e}}class s extends n{constructor(e,t,a,n,i,s,r){super(s,r,arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,arguments.length>8&&void 0!==arguments[8]?arguments[8]:null),this.documentList=e,this.entityName=n,this.dataSheetInfos=a,this.generateDataSheet=i,this.documentPacks=t}}class r{constructor(e,t){this.documentPackRequest=e,this.authDeniedCallback=t}}class o{}o.documentPackageDownloadRequested="DOWNLOAD_DOCUMENT_PACKAGE_REQUESTED",o.documentPackageDownloadRequestHandled="DOWNLOAD_DOCUMENT_PACKAGE_REQUEST_HANDLED",o.documentPackageCreationRequested="DOWNLOAD_DOCUMENT_PACKAGE_CREATION",o.documentPackageCreationRequestedHandled="DOWNLOAD_DOCUMENT_PACKAGE_CREATION_HANDLED",o.authenticationRequested="DOWNLOAD_DOCUMENT_AUTHENTICATION_REQUESTED",o.emptyResultReceived="DOWNLOAD_EMPTY_RESULT",o.watermarkingInputRequested="DOWNLOAD_DOCUMENT_WATERMARKING_INPUT_REQUESTED",o.watermarkingSingleDocumentInputRequested="DOWNLOAD_SINGLE_DOCUMENT_WATERMARKING_INPUT_REQUESTED",o.downloadLimitationReached="DOWNLOAD_LIMITATION_REACHED",o.failedRequest="DOWNLOAD_CENTER_FAILED_REQUEST";class l{constructor(e,t){this.skippedAuthentication=e,this.skippedWatermarking=t}}class c{constructor(e,t){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{},n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:()=>{};this.formCompleted=a,this.skipWatermarkingCallback=n,this.popupUrl=e,this.documentPackRequest=t}}class d{constructor(e,t){this.popupUrl=e,this.assetId=t}}},7785:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return b}});var n=a(1798),i=a(9755),s=a.n(i),r=a(2149),o=a(3018),l=a(5773),c=a(7391);class d{}class u extends d{constructor(e){super(),this.data=e}handleWatermarking(e){var t=new o.cn(e,this,this.onFormCompletedCallback,this.onWatermarkingSkippedCallback);n.PubSub.publish(o.er.watermarkingInputRequested,t)}handleAuthenticationRequest(e){var t=new o.C_(this,e);n.PubSub.publish(o.er.authenticationRequested,t)}onFormCompletedCallback(e,t){var a=new o.OP(this.data.documentList,this.data.documentPacks,this.data.dataSheetInfos,this.data.entityName,this.data.generateDataSheet,this.data.skippedAuthentication,!1,e,t);n.PubSub.publish(o.er.documentPackageCreationRequested,a)}onWatermarkingSkippedCallback(e){var t=new o.OP(e.data.documentList,e.data.documentPacks,e.data.dataSheetInfos,e.data.entityName,e.data.skippedAuthentication,!0,null,null);n.PubSub.publish(o.er.documentPackageCreationRequested,t)}authRequestDeniedCallback(e){var t=e.documentPackRequest.data;n.PubSub.publish(o.er.documentPackageCreationRequested,new o.OP(t.documentList,t.documentPacks,t.dataSheetInfos,t.entityName,t.generateDataSheet,!0,!1))}}class h extends d{constructor(e){super(),this.data=e}handleWatermarking(e){var t=new o.cn(e,this,this.onFormCompletedCallback,this.onWatermarkingSkippedCallback);n.PubSub.publish(o.er.watermarkingInputRequested,t)}handleAuthenticationRequest(e){var t=new o.C_(this,e);n.PubSub.publish(o.er.authenticationRequested,t)}onFormCompletedCallback(e,t){var a=new o.iF(this.data.documentPackId,!1,!1,e,t);n.PubSub.publish(o.er.documentPackageDownloadRequested,a)}onWatermarkingSkippedCallback(e){var t=new o.iF(e.data.documentPackId,e.data.skippedAuthentication,!0,null,null);n.PubSub.publish(o.er.documentPackageDownloadRequested,t)}authRequestDeniedCallback(e){n.PubSub.publish(o.er.documentPackageDownloadRequested,new o.iF(this.data.documentPackId,!0,!1))}}var p=a(3722);class b extends r.o{constructor(e){super(e),this.clientStorageSupported="undefined"!=typeof Storage,this.jobList=new Array,this.jobListLocalStorageKeyName="JOB_LIST",this.toasterContainerSelector="[data-js='download-job-container']",this.hideJobSelector="[data-js='hide-job']",this.classIsActive="is-active",this.downloadDeliveryLink="[data-js='document-pack-delivery-url']",this.jobIdAttributeName="data-js-job-id",this.lockedDocumentSelector="[data-download-locked]",this.lockedDocumentIdAttributeName="data-download-id",this.watermarkingLinkSelector="[data-js='watermark-form-trigger']",this.init()}init(){this.restoreJobList(),this.initializeToasterUpdater(!0),this.initializeJobInfoElementEvents(),this.initializeReloadEvents(),this.bindEvents(),n.PubSub.subscribe(p.ImsListerEvents.imsListerUpdated,()=>{this.bindEvents()}),n.PubSub.subscribe(o.er.documentPackageDownloadRequested,(e,t)=>{this.documentPackageDownloadRequestedHandler(t)}),n.PubSub.subscribe(o.er.documentPackageCreationRequested,(e,t)=>{this.documentPackageCreationRequestedHandler(t)})}initializeReloadEvents(){s()(document).on("click",this.lockedDocumentSelector,e=>{var t=s()(e.currentTarget).attr(this.lockedDocumentIdAttributeName);if("URLSearchParams"in window){var a=new URLSearchParams(window.location.search);a.set("download-id",t);var n=window.location.pathname+"?"+a.toString();history.pushState(null,"",n)}})}documentPackageCreationRequestedHandler(e){if(this.canStartNewJob()){var t=e,a=new l.o("".concat(this.parm.documentPackCreationUrl),t,!1);this.ajaxWrapper.doFetch(a).then(e=>{this.packCreationRequestedCallBack(e)})}else n.PubSub.publish(o.er.documentPackageCreationRequestedHandled,null)}documentPackageDownloadRequestedHandler(e){var t=new l.o("".concat(this.parm.documentPackRequestUrl),e,!1);this.canStartNewJob()?this.ajaxWrapper.doFetch(t).then(e=>{this.packRequestedCallback(e)}):n.PubSub.publish(o.er.documentPackageDownloadRequestHandled,null)}canStartNewJob(){return null!=this.jobList&&this.jobList.length<3||(n.PubSub.publish(o.er.downloadLimitationReached),!1)}packRequestedCallback(e){e.clone().text().then(e=>{var t=new c.E(e).getComponentUpdate("job-info"),a=t.json,i=new h(a),s=t.content;this.shouldRegisterJob(i)&&(this.registerJob(a,s),this.initializeJobInfoElementEvents()),n.PubSub.publish(o.er.documentPackageDownloadRequestHandled,null)})}packCreationRequestedCallBack(e){e.clone().text().then(e=>{var t=new c.E(e).getComponentUpdate("job-info"),a=t.json,i=new u(a),s=t.content;this.shouldRegisterJob(i)&&(this.registerJob(a,s),this.initializeJobInfoElementEvents()),n.PubSub.publish(o.er.documentPackageCreationRequestedHandled,null)})}authRequestDeniedCallback(e){e.documentPackRequest.authRequestDeniedCallback(e)}registerJob(e,t){null!==e&&null!==e.jobId&&(this.jobList.push(e),s()(this.toasterContainerSelector).append(t),this.persistJobList())}persistJobList(){if(this.clientStorageSupported){var e=JSON.stringify(this.jobList);window.localStorage.setItem(this.jobListLocalStorageKeyName,e)}}initializeToasterUpdater(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=!1;setInterval(()=>{if(!(t||this.jobList.length<=0)){t=!0;var a=!1;this.jobList.forEach(t=>{a=this.checkJobEntry(e,t)}),a&&this.initializeJobInfoElementEvents(),e=!1,t=!1}},3e3)}checkJobEntry(e,t){var a=!1;if(!t.ready||e){var n={jobId:t.jobId,fileName:t.fileName,fileCount:t.fileCount,thumbnailUrl:t.thumbnailUrl},i=new l.o(this.parm.jobStatusUrl,n,!1);i.method="POST",this.ajaxWrapper.doFetch(i).then(e=>a=this.checkJobEntryCallback(a,e))}return a}checkJobEntryCallback(e,t){return t.clone().text().then(t=>{var a=new c.E(t).getComponentUpdate("job-info"),n=a.json,i=a.content,s=this.jobList.findIndex(e=>e.jobId===n.jobId);this.jobList[s]=n,this.persistJobList(),this.addOrUpdateToaster(n,i),e=!0}),e}initializeJobInfoElementEvents(){s()(this.element).on("click","".concat(this.downloadDeliveryLink,", ").concat(this.hideJobSelector),e=>{var t=s()(e.target).closest("[".concat(this.jobIdAttributeName,"]")).attr(this.jobIdAttributeName);s()(this.element).find("[".concat(this.jobIdAttributeName,"='").concat(t,"']")).removeClass(this.classIsActive),this.removeJob(t)})}restoreJobList(){if(this.clientStorageSupported){var e=window.localStorage.getItem(this.jobListLocalStorageKeyName);null!==e?(this.jobList=JSON.parse(e),this.checkForExpiredJobs()):this.jobList=new Array}}removeJob(e){this.jobList.forEach((t,a)=>{t.jobId===e&&this.jobList.splice(a,1)}),this.persistJobList()}checkForExpiredJobs(){var e=new Date,t=!1;this.jobList.forEach((a,n)=>{null!==a.notAfter&&e>=a.notAfter&&(this.jobList.splice(n,1),t=!0)}),t&&this.persistJobList()}addOrUpdateToaster(e,t){var a=s()(this.element).find("[data-js-job-id='".concat(e.jobId,"']"));null!==a&&a.length>0?e.ready&&(a[0].outerHTML=t):s()(this.element).find(this.toasterContainerSelector).append(t)}shouldRegisterJob(e){return e.data.failed?(n.PubSub.publish(o.er.failedRequest,null),!1):e.data.needsAuthentication?(e.handleAuthenticationRequest(this.authRequestDeniedCallback),!1):(e.data.emptyResult&&n.PubSub.publish(o.er.emptyResultReceived,new o.Jb(e.data.skippedAuthentication,e.data.skippedWatermarking)),!e.data.needsWatermarking||(this.handleWatermarking(e),!1))}handleWatermarking(e){e.handleWatermarking(this.parm.watermarkPopupUrl)}onWatermarkingSkippedCallback(e){e.onWatermarkingSkippedCallback(e)}onFormCompletedCallback(e,t,a){e.onFormCompletedCallback(t,a)}bindEvents(){s()(this.watermarkingLinkSelector).click(e=>{var t=s()(e.target).closest("a"),a=t.attr("data-js-watermark-form"),i=t.attr("data-asset-id");n.PubSub.publish(o.er.watermarkingSingleDocumentInputRequested,new o.Fi(a,i)),e.stopPropagation(),e.preventDefault()})}}},3722:function(e,t,a){"use strict";a.r(t),a.d(t,{ImsListerEvents:function(){return R},default:function(){return E}});var n=a(2149),i=a(1798),s=a(1206),r=a(9755),o=a.n(r),l=a(7391),c=a(6453),d=a(50),u=a(3573),h=a(1833),p=".js-load-more",b=".js-facet-remove",m=".js-facet-reset",g=".js-text-remove",k=".js-facet-select",S=".js-text-search",C=".js-load-more-container",v=".js-list-items-container",f=".js-sorting";class R{}R.imsListerUpdated="IMS_LISTER_UPDATED";class E extends n.o{constructor(e){super(e),this.initialRendering=!0,this.SELECTOR_SPINNER=".js-spinner",this.SELECTOR_SPINNERINPUT=".js-spinner-input",this.SELECTOR_RANGESLIDERINPUT=".js-slider-wrapper",this.init()}init(){this.bindLoadMoreClick(),this.reInitializeSpinner(),this.bindFacetChange(),this.bindFacetDelete(),this.bindFacetReset(),this.bindFacetImageClick(),this.bindSearchChange(),this.bindSearchDelete(),this.bindSortingClick(),this.facetChange(),this.updateHistory(!0,!0),window.onpopstate=e=>{if(!1===this.initialRendering){var t=e.state;null==t&&(t=decodeURI(location.search)),this.facetMapAndListUpdate(null,null,t,!1)}},void 0!==this.parm.searchText&&null!==this.parm.searchText&&o()(S).val(this.parm.searchText)}bindFacetChange(){o()(this.element).on("change","[data-facet-name][data-facet-value-key]",e=>{var t=o()(e.currentTarget).children("input").is(":checked"),a=o()(e.currentTarget).data("facet-name"),n=o()(e.currentTarget).attr("value");this.selectionChanged(t,a,n)})}bindFacetDelete(){o()(this.element).on("click",b,e=>{var t=o()(e.currentTarget).is(":checked"),a=o()(e.currentTarget).data("facet-name"),n=o()(e.currentTarget).data("facet-value-key");this.selectionChanged(t,a,n)})}bindFacetReset(){o()(this.element).on("click",m,e=>{this.facetMapAndListUpdate(null,null,"/",!0)})}bindFacetImageClick(){o()(this.element).on("click",k,e=>{var t=o()(e.currentTarget).hasClass("active"),a=o()(e.currentTarget).data("facet-name"),n=o()(e.currentTarget).attr("value");this.selectionChanged(!t,a,n)})}bindSearchChange(){o()(this.element).on("keypress",S,e=>{if(13===e.which){e.preventDefault();var t=o()(e.currentTarget).val();this.searchByText(t)}})}bindSearchDelete(){o()(this.element).on("click",g,e=>{this.facetMapAndListUpdate(null,null,null,!0,null," ")})}bindLoadMoreClick(){o()(this.element).on("click",p,e=>{this.scrollPositionBeforeLoadMoreClick=document.documentElement.scrollTop||document.body.scrollTop,this.spinnerHandler.showSpinner(!1),o().ajax({type:"POST",url:this.parm.loadMoreUrl+"&ts="+(new Date).getTime(),data:{preFilter:o()("#preFilter").val(),currentQuery:o()("#currentQuery").val(),pageNumber:o()(e.currentTarget).data("loadmore-nextpage"),pageSize:o()(e.currentTarget).data("loadmore-pagesize"),totalPageGap:o()(e.currentTarget).data("loadmore-totalpagegap")}}).done(e=>{this.successLoadMoreAjaxCallback(e)})})}getScrollPositionBeforeLoadMoreClick(){return this.scrollPositionBeforeLoadMoreClick}bindSortingClick(){o()(this.element).on("click",f,e=>{this.spinnerHandler.showSpinner(!1),o().ajax({type:"POST",url:this.parm.sortingUrl+"&ts="+(new Date).getTime(),data:{preFilter:o()("#preFilter").val(),currentQuery:o()("#currentQuery").val(),sortAttribute:o()(e.currentTarget).data("sorting-name"),sortType:this.updateSorting(o()(e.currentTarget).data("sorting-type"))}}).done(e=>{var t=new l.E(e);o()("#list")[0].innerHTML=t.getComponentUpdate("list").content,this.updateHistory(!0),this.reInitializeSpinner()})})}facetChange(){i.PubSub.subscribe(s.N.facetUpdated,(e,t)=>{var a=t;this.selectionChanged(a.newValue,a.facetName,a.facetValueKey)})}updateSorting(e){return"asc"===e?"desc":"asc"}successLoadMoreAjaxCallback(e){var t=new l.E(e);o()(v)[0].innerHTML+=this.removeTableTags(t.getComponentUpdate("listItems").content),o()(C)[0].innerHTML=t.getComponentUpdate("loadMore").content,this.updateHistory(!0,!1,"#loadMoreQuery"),i.PubSub.publish(R.imsListerUpdated),this.spinnerHandler.hideSpinner(),i.PubSub.publish(R.imsListerUpdated)}removeTableTags(e){return o()(e).hasClass("js-delete")?o()(e).remove(".js-delete").prop("outerHTML"):e}searchByText(e){this.updating||this.facetMapAndListUpdate(null,null,null,!0,null,e)}selectionChanged(e,t,a){this.updating||this.facetMapAndListUpdate(t,a,null,!0,e,null)}facetMapAndListUpdate(e,t,a,n){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null;if(this.updating=!0,null==n&&(n=!0),null==a&&(a=o()("#currentQuery").val().toString()),null==s){var r=o()(S);if(void 0!==r.val()&&null!==r.val()){var l=o()(S).val().toString();null!=l&&l.length>1&&(s=l)}}var c={preFilter:o()("#preFilter").val(),currentQuery:a,facet:e,facetValue:t,selectFacetValue:!!t&&i,searchText:s};this.doAjaxRequest(n,c)}doAjaxRequest(e,t){this.spinnerHandler.showSpinner(!1),o().ajax({type:"POST",url:this.parm.updateUrl+"&ts="+(new Date).getTime(),data:t}).done(a=>{var n=new l.E(a);o()("#list")[0].innerHTML=n.getComponentUpdate("list").content,void 0!==o()("#totalCount")[0]&&(o()("#totalCount")[0].innerHTML=n.getComponentUpdate("totalCount").content),o()("#facetmapselection")[0].innerHTML=n.getComponentUpdate("facetmapselection").content;var s=o()(n.getComponentUpdate("facetmap").content).find(".js-facets-panel"),r=o()(n.getComponentUpdate("facetmap").content).find(".js-facets-show-result");o()(".js-facets-panel").replaceWith(s),o()(".js-facets-show-result").replaceWith(r),this.updateHistory(e),this.updating=!1,this.initialRendering=!1,this.reInitializeCollapse(),this.reInitializeSpinner(),this.reInitializeDropdown(),this.reInitializeSpinnerInput(),this.reInitializeRangeSliderInput(),i.PubSub.publish(R.imsListerUpdated),null!==t.searchText&&t.searchText.trim().length>0?o()(S).val(t.searchText):o()(S).val(""),this.spinnerHandler.hideSpinner()})}reInitializeSpinnerInput(){Array.from(this.element.querySelectorAll(this.SELECTOR_SPINNERINPUT)).forEach(e=>{new u.w(e)})}reInitializeRangeSliderInput(){Array.from(this.element.querySelectorAll(this.SELECTOR_RANGESLIDERINPUT)).forEach(e=>{new h.Y(e)})}reInitializeCollapse(){c.Z.initializeCollapse(this.element)}reInitializeSpinner(){this.spinnerHandler=new d.Z(this.element.querySelector(this.SELECTOR_SPINNER))}reInitializeDropdown(){c.Z.initializeDropdown(this.element)}processAjaxResponse(e){o()("#productList")[0].innerHTML=e;var t=o()('#productList script[type="json"]')[0].innerHTML;return o().parseJSON(t)}updateHistory(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"#currentUrlQuery";if(history.pushState&&e){var n=o()(a).val(),i=window.location.toString(),s=i.indexOf("?");s>-1&&(i=i.substr(0,s)),i=i+"?"+n,t?history.replaceState(n,null,i):history.pushState(n,null,i)}}}},7391:function(e,t,a){"use strict";a.d(t,{E:function(){return s}});var n=a(9755),i=a.n(n);class s{constructor(e){this.rawResponse=e,this.response=i()(e)}getComponentUpdate(e){var t=this.response.filter("[data-component="+e+"]");return t.length?{content:t.html().trim(),json:i().parseJSON(t.find("script")[0].innerHTML)}:null}}}}]);